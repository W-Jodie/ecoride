<div class="col-md-4 mb-4">
  <div class="card shadow-sm text-center border border-2 border-success">
    <div class="card-body" id="userProfile"></div>
  </div>
</div>

<script>
async function fetchUserProfile() {
    try {
        const userProfile = document.getElementById('userProfile');
        const url = '{{ path("app_api_profile") }}';

        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const userData = await response.json();
        console.log(userData);

        // Définition d'un email fallback si l'utilisateur n'a pas d'email configuré
        const email = userData.email ?? "pas de mail renseigné";

        // Solde du portefeuille (wallet)
        const credit = userData.wallet?.credit ?? 0;

        // Adresse (mise en forme propre)
        const address = userData.adress
            ? userData.adress.replace(/\n/g, "<br>")
            : "Adresse non renseignée";

        userProfile.innerHTML = `
            <img src="{{ asset('assets/img/marie.jpg') }}" 
                 alt="Photo de profil" 
                 class="rounded-circle mb-3 shadow w-50">

            <h5 class="fw-bold mb-1">${userData.firstName} ${userData.lastName}</h5>
            <p class="text-muted mb-3">Membre depuis 2024</p>

            <p><i class="bi bi-geo-alt-fill text-info me-2"></i> ${address}</p>

            <p>
              <i class="bi bi-envelope-fill text-info me-2"></i>
              <a href="mailto:${email}">${email}</a>
            </p>

            <hr>

            <!-- Statistiques -->
            <div class="d-flex justify-content-around mb-3">
                <div>
                    <h5 class="text-success mb-0">+120</h5>
                    <small>Trajets effectués</small>
                </div>
                <div>
                    <h5 class="text-info mb-0">4.8 ★</h5>
                    <small>Note moyenne</small>
                </div>
                <div>
                    <h5 class="text-warning mb-0">${credit.toFixed(2)} €</h5>
                    <small>Solde du porte-monnaie</small>
                </div>
            </div>

            <hr>

            <div class="d-grid gap-2 mt-3">
                <a href="#" class="btn btn-outline-primary btn-sm">Mode passager</a>
                <a href="{{ path('app_logout') }}" class="btn btn-outline-secondary btn-sm">Déconnexion</a>
            </div>
        `;

    } catch (error) {
        console.error('Fetch error:', error);
    }
}
fetchUserProfile()
setInterval(fetchUserProfile, 3000); 
</script>
