<div class="card shadow-lg border-2 border-success mb-4" >
  <div class="card-header bg-light text-dark d-flex justify-content-between align-items-center border-bottom-0">
                <h5 class="mb-0">ðŸš˜ Mes voitures</h5>
                <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">+ Ajouter une voiture</button>
            </div>

            <div class="card-body">
                <ul class="list-group" id ="carProfile">
                  
                </ul>
            </div>
    </div>
    {{include('pages/profile/_composants/_cars/_modal_add_car.html.twig')}}
<script>
async function fetchCarProfile() {
    try {
        const carProfile = document.getElementById('carProfile');
        const url = '{{ path("app_api_profile_car") }}';

        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const carData = await response.json();
        console.log(carData);

        // Si la rÃ©ponse contient un message, cela signifie : aucune voiture
      

        if (carData.message) {
    carProfile.innerHTML = `${carData.message}`;
    return;
}

        // Si on arrive ici => il y a bien un tableau de voitures
        let items = "";
        carData.forEach(car => {
            items += `
               <li class="list-group-item d-flex justify-content-between align-items-center">
    <div>
        <strong>${car.brand} ${car.model}</strong>
        ${car.isElectric ? '<span class="badge bg-success ms-2">Ã‰lectrique</span>' : ''}
    </div>

    <div class="d-flex align-items-center">
        <span class="badge bg-info me-3">Immat. : ${car.licensePlate}</span>
       <a href="#" onclick="deleteCar(${car.id})" class="text-danger ms-3">
    <i class="bi bi-trash"></i>
</a>

    </div>
</li>

            `;
        });

        carProfile.innerHTML = `
          
                    ${items}
              
        `;

    } catch (error) {
        console.error('Fetch error:', error);
    }
}

fetchCarProfile();

function deleteCar(id) {
    const url = "{{ path('api_car_delete', {'id': 'REPLACE_ID'}) }}".replace("REPLACE_ID", id);
    fetch(url, {
        method: 'DELETE'
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Voiture supprimÃ©e !");
            fetchCarProfile(); // rafraÃ®chir la liste
        } else {
            alert("Erreur : " + data.error);
        }
    })
    .catch(() => alert("Une erreur est survenue."));
}

</script>