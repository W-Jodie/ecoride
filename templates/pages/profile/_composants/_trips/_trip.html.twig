<div class="card is-driver-profile shadow-lg border-2 border-success mb-4">
    <div class="card-header bg-light text-dark d-flex justify-content-between align-items-center border-bottom-0">
        <h5 class="mb-0">üõ£Ô∏è Mes trajets</h5>
        <button class="btn btn-primary btn-sm"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasAddTrip"
        aria-controls="offcanvasAddTrip">
    + Ajouter un trajet
</button>
    </div>

    <div class="card-body">
        <div class="list-group" id="tripList">
            <!-- Le JS va injecter le contenu ici -->
        </div>
    </div>
</div>
    {{include('pages/profile/_composants/_trips/_modal_add_trip.html.twig')}}
<script>
async function fetchTripProfile() {
    try {
        const tripList = document.getElementById('tripList');
        const url = '{{ path("app_api_profile_trip") }}';

        const response = await fetch(url);
        const tripData = await response.json();

        // üõë Cas : aucun trajet (tableau vide)
        if (Array.isArray(tripData) && tripData.length === 0) {
            tripList.innerHTML = `
                <div class="list-group-item text-muted">
                    Vous n'avez pas encore de trajet.
                </div>
            `;
            return;
        }

        // üõë Cas : message
        if (tripData.message) {
            tripList.innerHTML = `
                <div class="list-group-item text-muted">
                    ${tripData.message}
                </div>
            `;
            return;
        }

        // üü¢ Normal : tableau de trajets
        let items = "";
        tripData.forEach(trip => {
            const departure = new Date(trip.departureAt);
            const arrival   = new Date(trip.arrivalAt);

            const options = { 
                day: '2-digit', month: '2-digit', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            };

            const departureFormatted = departure.toLocaleString('fr-FR', options);
            const arrivalFormatted   = arrival.toLocaleString('fr-FR', options);

            items += `
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${trip.departure} ‚Üí ${trip.arrival}</strong><br>
                        <small>${departureFormatted} ‚Üí ${arrivalFormatted}</small>
                    </div>
                    <span class="badge bg-info">Places : ${trip.seats}</span>
                    <span class="badge bg-info">Statut : ${trip.status}</span>
                </div>
            `;
        });

        tripList.innerHTML = items;

    } catch (error) {
        console.error('Erreur fetchTripProfile:', error);
    }
}

fetchTripProfile();
setInterval(fetchTripProfile, 30000);

document.addEventListener('DOMContentLoaded', () => {

    // Soumission du formulaire d'ajout de trajet
    document.getElementById('tripForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const payload = {
            departure: departure.value,
            arrival: arrival.value,
            date: date.value,
            time: time.value,
            seats: parseInt(seats.value),
            price: parseFloat(price.value)
        };

        const res = await fetch('/api/carpooling', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });

        const data = await res.json();
        const msg = document.getElementById('tripResponseMessage');

        if (res.ok) {
            msg.innerHTML = `<div class="alert alert-success">Trajet ajout√© !</div>`;
            document.getElementById('tripForm').reset();

            // Fermer l‚Äôoffcanvas
            const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasAddTrip'));
            if (offcanvas) offcanvas.hide();

            // Rafra√Æchir les trajets
            if (typeof fetchTripProfile === 'function') fetchTripProfile();

        } else {
            msg.innerHTML = `<div class="alert alert-danger">Erreur : ${data.error ?? 'Une erreur est survenue'}</div>`;
        }
    });

});
</script>